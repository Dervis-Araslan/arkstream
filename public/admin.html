<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArkStream Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .admin-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-logo i {
            font-size: 2rem;
            color: #e74c3c;
        }

        .admin-logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #95a5a6;
            color: white;
        }

        .nav-btn.active {
            background: #34495e;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Main Content */
        .admin-main {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Forms */
        .camera-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #34495e;
            font-size: 0.9rem;
        }

        .form-input {
            padding: 12px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-select {
            padding: 12px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1rem;
            background: #fff;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #d68910;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        /* Camera List */
        .camera-list {
            overflow-x: auto;
        }

        .camera-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .camera-table th,
        .camera-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .camera-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        .camera-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-connecting {
            background: #fff3cd;
            color: #856404;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* Stream Management */
        .stream-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .stream-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stream-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .stream-params {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #95a5a6;
            padding: 5px;
            border-radius: 5px;
        }

        .modal-close:hover {
            background: #ecf0f1;
            color: #2c3e50;
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-container {
                padding: 15px;
            }

            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .camera-form {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <i class="fas fa-shield-alt"></i>
                <h1>ArkStream Admin Panel</h1>
            </div>
            <div class="admin-nav">
                <button class="nav-btn active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </button>
                <button class="nav-btn" onclick="showSection('cameras')">
                    <i class="fas fa-video"></i>
                    Kameralar
                </button>
                <button class="nav-btn" onclick="showSection('streams')">
                    <i class="fas fa-broadcast-tower"></i>
                    Yayınlar
                </button>
                <a href="../index.html" class="nav-btn">
                    <i class="fas fa-eye"></i>
                    Canlı Görünüm
                </a>
            </div>
        </header>

        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard Section -->
            <section id="dashboard" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCamerasCount">0</div>
                        <div class="stat-label">Toplam Kamera</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeCamerasCount">0</div>
                        <div class="stat-label">Aktif Kamera</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalStreamsCount">0</div>
                        <div class="stat-label">Aktif Yayın</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalViewersCount">0</div>
                        <div class="stat-label">Toplam İzleyici</div>
                    </div>
                </div>

                <div class="camera-list">
                    <h3>Son Aktiviteler</h3>
                    <div id="recentActivities">
                        <!-- Recent activities will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Camera Management Section -->
            <section id="cameras" class="admin-section hidden">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-video"></i>
                        Kamera Yönetimi
                    </h2>
                    <button class="btn btn-primary" onclick="openAddCameraModal()">
                        <i class="fas fa-plus"></i>
                        Yeni Kamera Ekle
                    </button>
                </div>

                <div class="camera-list">
                    <table class="camera-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Kamera Adı</th>
                                <th>Konum</th>
                                <th>Marka/Model</th>
                                <th>IP Adresi</th>
                                <th>Durum</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody id="cameraTableBody">
                            <!-- Camera rows will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Stream Management Section -->
            <section id="streams" class="admin-section hidden">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-broadcast-tower"></i>
                        Yayın Yönetimi
                    </h2>
                    <button class="btn btn-success" onclick="openCreateStreamModal()">
                        <i class="fas fa-play"></i>
                        Yeni Yayın Oluştur
                    </button>
                </div>

                <div id="streamList">
                    <!-- Stream cards will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Add/Edit Camera Modal -->
    <div class="modal" id="cameraModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="cameraModalTitle">Yeni Kamera Ekle</h3>
                <button class="modal-close" onclick="closeCameraModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="cameraForm" onsubmit="saveCamera(event)">
                <input type="hidden" id="cameraId" />

                <div class="camera-form">
                    <div class="form-group">
                        <label class="form-label" for="cameraName">Kamera Adı *</label>
                        <input type="text" id="cameraName" class="form-input" required />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraLocation">Konum *</label>
                        <input type="text" id="cameraLocation" class="form-input" required />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraBrand">Marka *</label>
                        <select id="cameraBrand" class="form-select" required>
                            <option value="">Marka Seçin</option>
                            <option value="Hikvision">Hikvision</option>
                            <option value="Dahua">Dahua</option>
                            <option value="Samsung">Samsung</option>
                            <option value="Axis">Axis</option>
                            <option value="Uniview">Uniview</option>
                            <option value="Diğer">Diğer</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraModel">Model</label>
                        <input type="text" id="cameraModel" class="form-input" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraIp">IP Adresi *</label>
                        <input type="text" id="cameraIp" class="form-input" required
                            pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" placeholder="192.168.1.100" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraPort">Port</label>
                        <input type="number" id="cameraPort" class="form-input" min="1" max="65535" value="80" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraUsername">Kullanıcı Adı</label>
                        <input type="text" id="cameraUsername" class="form-input" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraPassword">Şifre</label>
                        <input type="password" id="cameraPassword" class="form-input" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraChannel">Kanal</label>
                        <input type="number" id="cameraChannel" class="form-input" min="1" value="1" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="cameraStatus">Durum</label>
                        <select id="cameraStatus" class="form-select">
                            <option value="active">Aktif</option>
                            <option value="inactive">Pasif</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeCameraModal()">İptal</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Kaydet
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Stream Modal -->
    <div class="modal" id="streamModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Yeni Yayın Oluştur</h3>
                <button class="modal-close" onclick="closeStreamModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="streamForm" onsubmit="createStream(event)">
                <div class="camera-form">
                    <div class="form-group">
                        <label class="form-label" for="streamCamera">Kamera Seçin *</label>
                        <select id="streamCamera" class="form-select" required>
                            <option value="">Kamera Seçin</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="streamQuality">Kalite</label>
                        <select id="streamQuality" class="form-select">
                            <option value="720p">720p</option>
                            <option value="1080p" selected>1080p</option>
                            <option value="4K">4K</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="streamBitrate">Bitrate (kbps)</label>
                        <input type="number" id="streamBitrate" class="form-input" value="2000" min="100" max="10000" />
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="streamFps">FPS</label>
                        <input type="number" id="streamFps" class="form-input" value="25" min="1" max="60" />
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeStreamModal()">İptal</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-play"></i>
                        Yayını Başlat
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let cameras = JSON.parse(localStorage.getItem('arkstream_cameras') || '[]');
        let streams = JSON.parse(localStorage.getItem('arkstream_streams') || '[]');
        let currentEditingCamera = null;

        // Initialize default cameras if empty
        if (cameras.length === 0) {
            cameras = [
                {
                    id: 1,
                    name: "Merkez Kavşağı",
                    location: "Bağcılar Merkez",
                    brand: "Hikvision",
                    model: "DS-2CD2043G2-I",
                    ip: "192.168.1.101",
                    port: 80,
                    username: "admin",
                    password: "admin123",
                    channel: 1,
                    status: "active",
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: "Belediye Binası",
                    location: "Bağcılar Merkez",
                    brand: "Dahua",
                    model: "IPC-HDW2431T-AS-S2",
                    ip: "192.168.1.102",
                    port: 80,
                    username: "admin",
                    password: "admin123",
                    channel: 1,
                    status: "active",
                    createdAt: new Date().toISOString()
                }
            ];
            saveCameras();
        }

        // Page initialization
        document.addEventListener('DOMContentLoaded', function () {
            loadDashboard();
            loadCameras();
            loadStreams();
        });

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName).classList.remove('hidden');

            // Add active class to clicked button
            event.target.classList.add('active');

            // Load section data
            if (sectionName === 'dashboard') loadDashboard();
            else if (sectionName === 'cameras') loadCameras();
            else if (sectionName === 'streams') loadStreams();
        }

        // Dashboard functions
        function loadDashboard() {
            const activeCameras = cameras.filter(cam => cam.status === 'active');
            const activeStreams = streams.filter(stream => stream.status === 'active');
            const totalViewers = activeStreams.reduce((sum, stream) => sum + (stream.viewers || 0), 0);

            document.getElementById('totalCamerasCount').textContent = cameras.length;
            document.getElementById('activeCamerasCount').textContent = activeCameras.length;
            document.getElementById('totalStreamsCount').textContent = activeStreams.length;
            document.getElementById('totalViewersCount').textContent = totalViewers;

            loadRecentActivities();
        }

        function loadRecentActivities() {
            const activities = [
                { type: 'info', message: 'Sistem başarıyla başlatıldı', time: '2 dakika önce' },
                { type: 'success', message: 'Yeni kamera eklendi: Merkez Kavşağı', time: '5 dakika önce' },
                { type: 'warning', message: 'Kamera bağlantısı koptu: Park Girişi', time: '10 dakika önce' }
            ];

            const container = document.getElementById('recentActivities');
            container.innerHTML = activities.map(activity => `
                <div class="alert alert-${activity.type === 'info' ? 'warning' : activity.type}">
                    <i class="fas fa-${activity.type === 'info' ? 'info-circle' : activity.type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    <span>${activity.message}</span>
                    <small style="margin-left: auto; opacity: 0.7;">${activity.time}</small>
                </div>
            `).join('');
        }

        // Camera management functions
        function loadCameras() {
            const tbody = document.getElementById('cameraTableBody');
            tbody.innerHTML = cameras.map(camera => `
                <tr>
                    <td>${camera.id}</td>
                    <td>${camera.name}</td>
                    <td>${camera.location}</td>
                    <td>${camera.brand} ${camera.model || ''}</td>
                    <td>${camera.ip}:${camera.port}</td>
                    <td>
                        <span class="status-badge status-${camera.status === 'active' ? 'active' : 'inactive'}">
                            ${camera.status === 'active' ? 'Aktif' : 'Pasif'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-warning" onclick="editCamera(${camera.id})">
                                <i class="fas fa-edit"></i>
                                Düzenle
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteCamera(${camera.id})">
                                <i class="fas fa-trash"></i>
                                Sil
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function openAddCameraModal() {
            currentEditingCamera = null;
            document.getElementById('cameraModalTitle').textContent = 'Yeni Kamera Ekle';
            document.getElementById('cameraForm').reset();
            document.getElementById('cameraId').value = '';
            document.getElementById('cameraModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function editCamera(cameraId) {
            const camera = cameras.find(cam => cam.id === cameraId);
            if (!camera) return;

            currentEditingCamera = camera;
            document.getElementById('cameraModalTitle').textContent = 'Kamera Düzenle';

            // Fill form with camera data
            document.getElementById('cameraId').value = camera.id;
            document.getElementById('cameraName').value = camera.name;
            document.getElementById('cameraLocation').value = camera.location;
            document.getElementById('cameraBrand').value = camera.brand;
            document.getElementById('cameraModel').value = camera.model || '';
            document.getElementById('cameraIp').value = camera.ip;
            document.getElementById('cameraPort').value = camera.port;
            document.getElementById('cameraUsername').value = camera.username || '';
            document.getElementById('cameraPassword').value = camera.password || '';
            document.getElementById('cameraChannel').value = camera.channel || 1;
            document.getElementById('cameraStatus').value = camera.status;

            document.getElementById('cameraModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function deleteCamera(cameraId) {
            if (confirm('Bu kamerayı silmek istediğinizden emin misiniz?')) {
                cameras = cameras.filter(cam => cam.id !== cameraId);

                // Also remove related streams
                streams = streams.filter(stream => stream.cameraId !== cameraId);

                saveCameras();
                saveStreams();
                loadCameras();
                loadDashboard();

                showAlert('Kamera başarıyla silindi!', 'success');
            }
        }

        function saveCamera(event) {
            event.preventDefault();

            const formData = {
                name: document.getElementById('cameraName').value,
                location: document.getElementById('cameraLocation').value,
                brand: document.getElementById('cameraBrand').value,
                model: document.getElementById('cameraModel').value,
                ip: document.getElementById('cameraIp').value,
                port: parseInt(document.getElementById('cameraPort').value) || 80,
                username: document.getElementById('cameraUsername').value,
                password: document.getElementById('cameraPassword').value,
                channel: parseInt(document.getElementById('cameraChannel').value) || 1,
                status: document.getElementById('cameraStatus').value
            };

            // Validation
            if (!formData.name || !formData.location || !formData.brand || !formData.ip) {
                showAlert('Lütfen zorunlu alanları doldurun!', 'error');
                return;
            }

            // IP validation
            const ipPattern = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
            if (!ipPattern.test(formData.ip)) {
                showAlert('Geçerli bir IP adresi girin!', 'error');
                return;
            }

            if (currentEditingCamera) {
                // Update existing camera
                const index = cameras.findIndex(cam => cam.id === currentEditingCamera.id);
                cameras[index] = { ...cameras[index], ...formData, updatedAt: new Date().toISOString() };
                showAlert('Kamera başarıyla güncellendi!', 'success');
            } else {
                // Add new camera
                const newCamera = {
                    id: Math.max(...cameras.map(cam => cam.id), 0) + 1,
                    ...formData,
                    createdAt: new Date().toISOString()
                };
                cameras.push(newCamera);
                showAlert('Yeni kamera başarıyla eklendi!', 'success');
            }

            saveCameras();
            loadCameras();
            loadDashboard();
            closeCameraModal();
        }

        function closeCameraModal() {
            document.getElementById('cameraModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentEditingCamera = null;
        }

        // Stream management functions
        function loadStreams() {
            const container = document.getElementById('streamList');

            if (streams.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i>
                        Henüz aktif yayın bulunmuyor. Yeni yayın oluşturmak için "Yeni Yayın Oluştur" butonuna tıklayın.
                    </div>
                `;
                return;
            }

            container.innerHTML = streams.map(stream => {
                const camera = cameras.find(cam => cam.id === stream.cameraId);
                return `
                    <div class="stream-card">
                        <div class="stream-header">
                            <div class="stream-name">${camera ? camera.name : 'Bilinmeyen Kamera'}</div>
                            <div class="action-buttons">
                                <button class="btn btn-small ${stream.status === 'active' ? 'btn-warning' : 'btn-success'}" 
                                        onclick="toggleStream(${stream.id})">
                                    <i class="fas fa-${stream.status === 'active' ? 'pause' : 'play'}"></i>
                                    ${stream.status === 'active' ? 'Durdur' : 'Başlat'}
                                </button>
                                <button class="btn btn-small btn-danger" onclick="deleteStream(${stream.id})">
                                    <i class="fas fa-trash"></i>
                                    Sil
                                </button>
                            </div>
                        </div>
                        <div class="stream-params">
                            <div>
                                <strong>Durum:</strong> 
                                <span class="status-badge status-${stream.status === 'active' ? 'active' : 'inactive'}">
                                    ${stream.status === 'active' ? 'Aktif' : 'Pasif'}
                                </span>
                            </div>
                            <div><strong>Kalite:</strong> ${stream.quality}</div>
                            <div><strong>Bitrate:</strong> ${stream.bitrate} kbps</div>
                            <div><strong>FPS:</strong> ${stream.fps}</div>
                            <div><strong>İzleyici:</strong> ${stream.viewers || 0}</div>
                            <div><strong>Oluşturulma:</strong> ${new Date(stream.createdAt).toLocaleString('tr-TR')}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openCreateStreamModal() {
            const cameraSelect = document.getElementById('streamCamera');

            // Load available cameras
            const availableCameras = cameras.filter(cam => cam.status === 'active');
            cameraSelect.innerHTML = '<option value="">Kamera Seçin</option>' +
                availableCameras.map(camera =>
                    `<option value="${camera.id}">${camera.name} (${camera.location})</option>`
                ).join('');

            if (availableCameras.length === 0) {
                showAlert('Yayın oluşturmak için önce aktif kamera eklemelisiniz!', 'warning');
                return;
            }

            document.getElementById('streamForm').reset();
            document.getElementById('streamModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function createStream(event) {
            event.preventDefault();

            const cameraId = parseInt(document.getElementById('streamCamera').value);
            const quality = document.getElementById('streamQuality').value;
            const bitrate = parseInt(document.getElementById('streamBitrate').value);
            const fps = parseInt(document.getElementById('streamFps').value);

            if (!cameraId) {
                showAlert('Lütfen bir kamera seçin!', 'error');
                return;
            }

            // Check if stream already exists for this camera
            const existingStream = streams.find(stream => stream.cameraId === cameraId);
            if (existingStream) {
                showAlert('Bu kamera için zaten bir yayın mevcut!', 'warning');
                return;
            }

            const newStream = {
                id: Math.max(...streams.map(stream => stream.id), 0) + 1,
                cameraId: cameraId,
                quality: quality,
                bitrate: bitrate,
                fps: fps,
                status: 'active',
                viewers: Math.floor(Math.random() * 50), // Simulate viewers
                createdAt: new Date().toISOString()
            };

            streams.push(newStream);
            saveStreams();
            loadStreams();
            loadDashboard();
            closeStreamModal();

            showAlert('Yayın başarıyla oluşturuldu ve başlatıldı!', 'success');
        }

        function toggleStream(streamId) {
            const stream = streams.find(s => s.id === streamId);
            if (stream) {
                stream.status = stream.status === 'active' ? 'inactive' : 'active';
                if (stream.status === 'inactive') {
                    stream.viewers = 0;
                } else {
                    stream.viewers = Math.floor(Math.random() * 50);
                }
                saveStreams();
                loadStreams();
                loadDashboard();

                const action = stream.status === 'active' ? 'başlatıldı' : 'durduruldu';
                showAlert(`Yayın başarıyla ${action}!`, 'success');
            }
        }

        function deleteStream(streamId) {
            if (confirm('Bu yayını silmek istediğinizden emin misiniz?')) {
                streams = streams.filter(stream => stream.id !== streamId);
                saveStreams();
                loadStreams();
                loadDashboard();
                showAlert('Yayın başarıyla silindi!', 'success');
            }
        }

        function closeStreamModal() {
            document.getElementById('streamModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Utility functions
        function saveCameras() {
            localStorage.setItem('arkstream_cameras', JSON.stringify(cameras));
        }

        function saveStreams() {
            localStorage.setItem('arkstream_streams', JSON.stringify(streams));
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert_' + Date.now();

            const alertHTML = `
                <div id="${alertId}" class="alert alert-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                </div>
            `;

            alertContainer.insertAdjacentHTML('beforeend', alertHTML);

            // Auto remove after 5 seconds
            setTimeout(() => {
                const alertElement = document.getElementById(alertId);
                if (alertElement) {
                    alertElement.remove();
                }
            }, 5000);
        }

        // Modal close handlers
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeCameraModal();
                closeStreamModal();
            }
        });

        // Close modals on outside click
        document.getElementById('cameraModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeCameraModal();
            }
        });

        document.getElementById('streamModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeStreamModal();
            }
        });

        // Auto-refresh dashboard every 30 seconds
        setInterval(() => {
            if (!document.getElementById('dashboard').classList.contains('hidden')) {
                loadDashboard();
            }
        }, 30000);
    </script>
</body>

</html>
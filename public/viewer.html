<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamera YayÄ±n Ä°zleyici</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #video {
            width: 100%;
            height: auto;
            display: block;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .status {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .stream-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .stream-info h3 {
            margin-top: 0;
            color: #495057;
        }

        .stream-info p {
            margin: 5px 0;
            color: #6c757d;
        }

        .url-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }

            .controls {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸŽ¥ Kamera YayÄ±n Ä°zleyici</h1>

        <div id="status" class="status info">
            BaÄŸlantÄ± bekleniyor...
        </div>

        <div class="controls">
            <input type="text" id="streamUrl" class="url-input" value="/public/kamera2.m3u8"
                placeholder="HLS Stream URL'si girin">
            <button onclick="loadStream()">YayÄ±n YÃ¼kle</button>
            <button onclick="playStream()">Oynat</button>
            <button onclick="pauseStream()">Duraklat</button>
            <button onclick="stopStream()">Durdur</button>
            <button onclick="toggleMute()">Ses AÃ§/Kapat</button>
            <button onclick="toggleFullscreen()">Tam Ekran</button>
        </div>

        <div class="video-container">
            <video id="video" controls
                poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Crect width='100%25' height='100%25' fill='%23333'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' fill='white' font-size='24' dy='.3em'%3EKamera YayÄ±nÄ± YÃ¼kleniyor...%3C/text%3E%3C/svg%3E">
                TarayÄ±cÄ±nÄ±z HTML5 video desteklemiyor.
            </video>
        </div>

        <div class="stream-info">
            <h3>ðŸ“Š YayÄ±n Bilgileri</h3>
            <p><strong>Durum:</strong> <span id="streamStatus">Bekleniyor</span></p>
            <p><strong>Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k:</strong> <span id="streamResolution">-</span></p>
            <p><strong>Kalite:</strong> <span id="streamQuality">-</span></p>
            <p><strong>SÃ¼re:</strong> <span id="streamDuration">-</span></p>
            <p><strong>Tampon Durumu:</strong> <span id="bufferStatus">-</span></p>
        </div>
    </div>

    <script>
        let hls = null;
        let video = document.getElementById('video');
        let isStreamLoaded = false;

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function updateStreamInfo() {
            const streamStatus = document.getElementById('streamStatus');
            const streamResolution = document.getElementById('streamResolution');
            const streamQuality = document.getElementById('streamQuality');
            const streamDuration = document.getElementById('streamDuration');
            const bufferStatus = document.getElementById('bufferStatus');

            if (video.videoWidth && video.videoHeight) {
                streamResolution.textContent = `${video.videoWidth}x${video.videoHeight}`;
            }

            if (video.duration && !isNaN(video.duration)) {
                const minutes = Math.floor(video.duration / 60);
                const seconds = Math.floor(video.duration % 60);
                streamDuration.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            if (video.readyState >= 2) {
                streamStatus.textContent = video.paused ? 'DuraklatÄ±ldÄ±' : 'OynatÄ±lÄ±yor';

                const buffered = video.buffered;
                if (buffered.length > 0) {
                    const bufferEnd = buffered.end(buffered.length - 1);
                    const bufferPercent = Math.round((bufferEnd / video.duration) * 100);
                    bufferStatus.textContent = `%${bufferPercent}`;
                }
            }
        }

        function loadStream() {
            const url = document.getElementById('streamUrl').value.trim();

            if (!url) {
                updateStatus('LÃ¼tfen geÃ§erli bir URL girin', 'error');
                return;
            }

            updateStatus('YayÄ±n yÃ¼kleniyor...', 'info');

            // Ã–nceki stream'i temizle
            if (hls) {
                hls.destroy();
                hls = null;
            }

            if (Hls.isSupported()) {
                hls = new Hls({
                    debug: false,
                    enableWorker: true,
                    lowLatencyMode: true,
                    liveSyncDuration: 2,
                    liveMaxLatencyDuration: 8,
                    maxBufferLength: 10
                });

                hls.loadSource(url);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    updateStatus('YayÄ±n baÅŸarÄ±yla yÃ¼klendi', 'success');
                    isStreamLoaded = true;

                    // Otomatik oynatmaya Ã§alÄ±ÅŸ
                    video.play().catch(e => {
                        updateStatus('Otomatik oynatma baÅŸarÄ±sÄ±z - manuel oynatÄ±n', 'info');
                    });
                });

                hls.on(Hls.Events.ERROR, function (event, data) {
                    console.error('HLS Error:', data);

                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                updateStatus('AÄŸ baÄŸlantÄ± hatasÄ± - yeniden denenecek', 'error');
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                updateStatus('Medya hatasÄ± - kurtarÄ±lmaya Ã§alÄ±ÅŸÄ±lÄ±yor', 'error');
                                hls.recoverMediaError();
                                break;
                            default:
                                updateStatus('KurtarÄ±lamaz hata oluÅŸtu', 'error');
                                break;
                        }
                    }
                });

            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Safari iÃ§in native HLS desteÄŸi
                video.src = url;
                updateStatus('Safari native HLS kullanÄ±lÄ±yor', 'success');
                isStreamLoaded = true;
            } else {
                updateStatus('HLS desteÄŸi bulunamadÄ±', 'error');
            }
        }

        function playStream() {
            if (isStreamLoaded) {
                video.play();
            } else {
                updateStatus('Ã–nce yayÄ±n yÃ¼klenmeli', 'error');
            }
        }

        function pauseStream() {
            video.pause();
        }

        function stopStream() {
            video.pause();
            video.currentTime = 0;
            updateStatus('YayÄ±n durduruldu', 'info');
        }

        function toggleMute() {
            video.muted = !video.muted;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                video.requestFullscreen().catch(err => {
                    console.log('Tam ekran hatasÄ±:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Video event listeners
        video.addEventListener('loadstart', () => updateStreamInfo());
        video.addEventListener('loadedmetadata', () => updateStreamInfo());
        video.addEventListener('play', () => updateStreamInfo());
        video.addEventListener('pause', () => updateStreamInfo());
        video.addEventListener('timeupdate', () => updateStreamInfo());
        video.addEventListener('progress', () => updateStreamInfo());

        // Sayfa yÃ¼klendiÄŸinde otomatik yÃ¼kle
        document.addEventListener('DOMContentLoaded', function () {
            // 2 saniye bekle ve otomatik yÃ¼kle
            setTimeout(() => {
                loadStream();
            }, 2000);
        });
    </script>
</body>

</html>
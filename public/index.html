<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ark Stream - IP Kamera YÃ¶netim Sistemi</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border-radius: 25px;
            cursor: pointer;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        /* Navigation */
        .nav-tabs {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 0 2rem;
            display: flex;
            gap: 2rem;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .card h2 {
            margin-bottom: 1rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Stream Grid */
        .stream-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .stream-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stream-card:hover {
            transform: translateY(-5px);
        }

        .stream-preview {
            width: 100%;
            height: 200px;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        .stream-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .stream-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stream-card:hover .stream-overlay {
            opacity: 1;
        }

        .play-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #333;
        }

        .stream-info {
            padding: 1rem;
        }

        .stream-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .stream-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .stream-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Status indicators */
        .status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-error {
            background: #fff3cd;
            color: #856404;
        }

        /* Video Player Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            width: 90%;
            max-width: 1000px;
            position: relative;
        }

        .modal-video {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                padding: 0 1rem;
                flex-wrap: wrap;
            }

            .main-content {
                padding: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stream-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Admin specific styles */
        .admin-only {
            border-left: 4px solid #dc3545;
            padding-left: 1rem;
        }

        .permission-badge {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-video"></i>
                Ark Stream
            </div>
            <div class="user-menu">
                <div class="user-info" id="userInfo">
                    <i class="fas fa-user"></i>
                    <span id="userName">Guest</span>
                    <span class="permission-badge" id="userRole">viewer</span>
                </div>
                <button class="btn btn-secondary" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    GiriÅŸ Yap
                </button>
                <button class="btn btn-danger" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    Ã‡Ä±kÄ±ÅŸ
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <div class="nav-tab active" data-page="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard
            </div>
            <div class="nav-tab" data-page="streams">
                <i class="fas fa-play-circle"></i>
                CanlÄ± YayÄ±nlar
            </div>
            <div class="nav-tab" data-page="cameras" id="camerasTab" style="display: none;">
                <i class="fas fa-camera"></i>
                Kameralar
            </div>
            <div class="nav-tab" data-page="admin" id="adminTab" style="display: none;">
                <i class="fas fa-cog"></i>
                Admin Panel
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <div class="card">
                    <h2><i class="fas fa-chart-line"></i> Sistem Durumu</h2>
                    <div class="dashboard-grid">
                        <div class="stream-info">
                            <div class="stream-title">${stream.name}</div>
                            <div class="stream-meta">
                                <span><i class="fas fa-eye"></i> ${stream.viewerCount} izleyici</span>
                                <span class="status status-${stream.status}">${stream.status}</span>
                            </div>
                            <div class="stream-meta">
                                <span><i class="fas fa-camera"></i> ${stream.camera.name}</span>
                                <span><i class="fas fa-map-marker-alt"></i> ${stream.camera.location || 'Konum
                                    yok'}</span>
                            </div>
                        </div>
                    </div>
                    `).join('');

                    grid.innerHTML = streamHTML;

                    // Show top 3 in popular section
                    const topStreams = streams
                    .sort((a, b) => b.viewerCount - a.viewerCount)
                    .slice(0, 3);
                    popularGrid.innerHTML = topStreams.map(stream => `
                    <div class="stream-card" data-stream-id="${stream.id}">
                        <div class="stream-preview">
                            <div class="stream-overlay">
                                <button class="play-btn" onclick="app.playStream('${stream.hlsUrl}', '${stream.name}')">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </div>
                        <div class="stream-info">
                            <div class="stream-title">${stream.name}</div>
                            <div class="stream-meta">
                                <span><i class="fas fa-eye"></i> ${stream.viewerCount} izleyici</span>
                                <span><i class="fas fa-fire"></i> PopÃ¼ler</span>
                            </div>
                        </div>
                    </div>
                    `).join('');
                    }

                    async loadCameras() {
                    if (!this.user || !['admin', 'operator'].includes(this.user.role)) {
                    return;
                    }

                    try {
                    const response = await fetch('/api/cameras', {
                    headers: {
                    'Authorization': `Bearer ${this.token}`
                    }
                    });

                    if (response.ok) {
                    const data = await response.json();
                    this.renderCameras(data.cameras);
                    }
                    } catch (error) {
                    console.error('Cameras load error:', error);
                    }
                    }

                    renderCameras(cameras) {
                    const grid = document.getElementById('camerasGrid');

                    if (cameras.length === 0) {
                    grid.innerHTML = '<p>HenÃ¼z kamera eklenmemiÅŸ.</p>';
                    return;
                    }

                    const camerasHTML = cameras.map(camera => `
                    <div class="card">
                        <h3>${camera.name}</h3>
                        <div class="stream-meta">
                            <span><i class="fas fa-video"></i> ${camera.brand} ${camera.model}</span>
                            <span class="status status-${camera.isOnline ? 'active' : 'inactive'}">
                                ${camera.isOnline ? 'Online' : 'Offline'}
                            </span>
                        </div>
                        <div class="stream-meta">
                            <span><i class="fas fa-network-wired"></i> ${camera.ip}:${camera.port}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${camera.location || 'Konum yok'}</span>
                        </div>
                        <div class="stream-actions">
                            <button class="btn btn-primary btn-sm" onclick="app.testCamera(${camera.id})">
                                <i class="fas fa-wifi"></i> Test
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="app.createStream(${camera.id})">
                                <i class="fas fa-play"></i> Stream OluÅŸtur
                            </button>
                            ${this.user.role === 'admin' ? `
                            <button class="btn btn-danger btn-sm" onclick="app.deleteCamera(${camera.id})">
                                <i class="fas fa-trash"></i> Sil
                            </button>
                            ` : ''}
                        </div>
                        ${camera.streams && camera.streams.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <strong>Streams:</strong>
                            ${camera.streams.map(stream => `
                            <div class="stream-meta" style="margin-left: 1rem;">
                                <span>${stream.name}</span>
                                <span class="status status-${stream.status}">${stream.status}</span>
                            </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                    `).join('');

                    grid.innerHTML = camerasHTML;
                    }

                    async loadAdminData() {
                    if (!this.user || this.user.role !== 'admin') {
                    return;
                    }

                    try {
                    const response = await fetch('/api/admin/system-overview', {
                    headers: {
                    'Authorization': `Bearer ${this.token}`
                    }
                    });

                    if (response.ok) {
                    const data = await response.json();

                    document.getElementById('adminTotalUsers').textContent = data.database.users;
                    document.getElementById('adminSystemUptime').textContent =
                    Math.floor(data.system.stats?.uptime / 3600) + 'h';
                    document.getElementById('adminErrorCount').textContent = data.recentErrors.length;
                    document.getElementById('adminMemoryUsage').textContent =
                    data.system.stats?.memoryUsage.toFixed(1) + '%';
                    }
                    } catch (error) {
                    console.error('Admin data load error:', error);
                    }
                    }

                    async addCamera() {
                    const formData = {
                    name: document.getElementById('cameraName').value,
                    brand: document.getElementById('cameraBrand').value,
                    model: document.getElementById('cameraModel').value,
                    ip: document.getElementById('cameraIp').value,
                    port: parseInt(document.getElementById('cameraPort').value),
                    username: document.getElementById('cameraUsername').value,
                    password: document.getElementById('cameraPassword').value,
                    location: document.getElementById('cameraLocation').value
                    };

                    try {
                    const response = await fetch('/api/cameras', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${this.token}`
                    },
                    body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    if (response.ok) {
                    alert('Kamera baÅŸarÄ±yla eklendi!');
                    document.getElementById('addCameraForm').style.display = 'none';
                    document.getElementById('cameraForm').reset();
                    this.loadCameras();
                    } else {
                    alert(data.error || 'Kamera eklenirken hata oluÅŸtu');
                    }
                    } catch (error) {
                    console.error('Add camera error:', error);
                    alert('Kamera eklenirken hata oluÅŸtu');
                    }
                    }

                    async testCamera(cameraId) {
                    try {
                    const response = await fetch(`/api/cameras/${cameraId}/test`, {
                    method: 'POST',
                    headers: {
                    'Authorization': `Bearer ${this.token}`
                    }
                    });

                    const data = await response.json();

                    if (data.success) {
                    alert('âœ… Kamera baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!');
                    } else {
                    alert('âŒ Kamera baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z: ' + data.details);
                    }
                    } catch (error) {
                    console.error('Camera test error:', error);
                    alert('Kamera testi sÄ±rasÄ±nda hata oluÅŸtu');
                    }
                    }

                    async createStream(cameraId) {
                    const streamName = prompt('Stream adÄ±nÄ± girin:');
                    if (!streamName) return;

                    try {
                    const response = await fetch('/api/streams', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${this.token}`
                    },
                    body: JSON.stringify({
                    cameraId: cameraId,
                    name: streamName,
                    quality: 'medium',
                    isPublic: true
                    })
                    });

                    const data = await response.json();

                    if (response.ok) {
                    alert('Stream baÅŸarÄ±yla oluÅŸturuldu!');
                    this.loadCameras();
                    } else {
                    alert(data.error || 'Stream oluÅŸturulurken hata oluÅŸtu');
                    }
                    } catch (error) {
                    console.error('Create stream error:', error);
                    alert('Stream oluÅŸturulurken hata oluÅŸtu');
                    }
                    }

                    async deleteCamera(cameraId) {
                    if (!confirm('Bu kamerayÄ± silmek istediÄŸinizden emin misiniz?')) {
                    return;
                    }

                    try {
                    const response = await fetch(`/api/cameras/${cameraId}`, {
                    method: 'DELETE',
                    headers: {
                    'Authorization': `Bearer ${this.token}`
                    }
                    });

                    if (response.ok) {
                    alert('Kamera baÅŸarÄ±yla silindi!');
                    this.loadCameras();
                    } else {
                    const data = await response.json();
                    alert(data.error || 'Kamera silinirken hata oluÅŸtu');
                    }
                    } catch (error) {
                    console.error('Delete camera error:', error);
                    alert('Kamera silinirken hata oluÅŸtu');
                    }
                    }

                    playStream(hlsUrl, streamName) {
                    const modal = document.getElementById('videoModal');
                    const video = document.getElementById('modalVideo');

                    modal.classList.add('active');

                    if (this.currentHLS) {
                    this.currentHLS.destroy();
                    }

                    if (Hls.isSupported()) {
                    this.currentHLS = new Hls({
                    liveSyncDurationCount: 3,
                    liveMaxLatencyDurationCount: 5,
                    liveDurationInfinity: true,
                    lowLatencyMode: true
                    });

                    this.currentHLS.loadSource(hlsUrl);
                    this.currentHLS.attachMedia(video);

                    this.currentHLS.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play().catch(e => {
                    console.error('Video play error:', e);
                    });
                    });

                    this.currentHLS.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                    console.error('HLS Error:', data);
                    alert('Video yÃ¼klenirken hata oluÅŸtu');
                    this.closeVideoModal();
                    }
                    });
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = hlsUrl;
                    video.addEventListener('loadedmetadata', () => {
                    video.play();
                    });
                    } else {
                    alert('TarayÄ±cÄ±nÄ±z HLS formatÄ±nÄ± desteklemiyor');
                    this.closeVideoModal();
                    }
                    }

                    closeVideoModal() {
                    const modal = document.getElementById('videoModal');
                    const video = document.getElementById('modalVideo');

                    modal.classList.remove('active');
                    video.pause();
                    video.src = '';

                    if (this.currentHLS) {
                    this.currentHLS.destroy();
                    this.currentHLS = null;
                    }
                    }

                    connectWebSocket() {
                    if (!this.token || this.ws) return;

                    try {
                    this.ws = new WebSocket(`ws://${window.location.host}/ws?token=${this.token}`);

                    this.ws.onopen = () => {
                    console.log('WebSocket connected');

                    // Subscribe to relevant channels
                    this.ws.send(JSON.stringify({
                    type: 'subscribe',
                    data: { channels: ['system:status', 'streams:all'] }
                    }));
                    };

                    this.ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    this.handleWebSocketMessage(message);
                    };

                    this.ws.onclose = () => {
                    console.log('WebSocket disconnected');
                    this.ws = null;

                    // Reconnect after 5 seconds
                    setTimeout(() => {
                    if (this.token) {
                    this.connectWebSocket();
                    }
                    }, 5000);
                    };

                    this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    };
                    } catch (error) {
                    console.error('WebSocket connection error:', error);
                    }
                    }

                    handleWebSocketMessage(message) {
                    switch (message.type) {
                    case 'connection:established':
                    console.log('WebSocket connection established');
                    break;

                    case 'stream:started':
                    console.log('Stream started:', message.data);
                    this.loadStreams();
                    this.loadDashboard();
                    break;

                    case 'stream:stopped':
                    console.log('Stream stopped:', message.data);
                    this.loadStreams();
                    this.loadDashboard();
                    break;

                    case 'viewer:count':
                    this.updateViewerCount(message.data.streamId, message.data.viewerCount);
                    break;

                    case 'dashboard:update':
                    this.updateDashboardStats(message.data);
                    break;

                    case 'system:alert':
                    this.showSystemAlert(message.data);
                    break;

                    default:
                    console.log('Unhandled WebSocket message:', message.type);
                    }
                    }

                    updateViewerCount(streamId, viewerCount) {
                    const streamCard = document.querySelector(`[data-stream-id="${streamId}"]`);
                    if (streamCard) {
                    const viewerElement = streamCard.querySelector('.fa-eye').parentElement;
                    if (viewerElement) {
                    viewerElement.innerHTML = `<i class="fas fa-eye"></i> ${viewerCount} izleyici`;
                    }
                    }
                    }

                    updateDashboardStats(stats) {
                    if (stats.streams) {
                    document.getElementById('totalStreams').textContent = stats.streams.total || 0;
                    document.getElementById('activeStreams').textContent = stats.streams.active || 0;
                    }
                    if (stats.viewers) {
                    document.getElementById('totalViewers').textContent = stats.viewers.total || 0;
                    }
                    if (stats.cameras) {
                    document.getElementById('totalCameras').textContent = stats.cameras.total || 0;
                    }
                    }

                    showSystemAlert(alert) {
                    if (alert.severity === 'critical') {
                    alert(`ðŸš¨ Sistem UyarÄ±sÄ±: ${alert.message}`);
                    } else {
                    console.warn('System Alert:', alert);
                    }
                    }

                    // Auto refresh data every 30 seconds
                    startAutoRefresh() {
                    setInterval(() => {
                    this.loadDashboard();

                    const activePage = document.querySelector('.page.active').id;
                    if (activePage === 'streams') {
                    this.loadStreams();
                    }
                    }, 30000);
                    }
                    }

                    // Initialize app
                    const app = new ArkStreamApp();
                    app.startAutoRefresh();

                    // Handle click outside modal to close
                    window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                    if (e.target.id === 'videoModal') {
                    app.closeVideoModal();
                    } else if (e.target.id === 'loginModal') {
                    e.target.classList.remove('active');
                    }
                    }
                    });
                    </script>
</body>

</html>="stat-card">
<div class="stat-value" id="totalStreams">0</div>
<div class="stat-label">Toplam Stream</div>
</div>
<div class="stat-card">
    <div class="stat-value" id="activeStreams">0</div>
    <div class="stat-label">Aktif Stream</div>
</div>
<div class="stat-card">
    <div class="stat-value" id="totalViewers">0</div>
    <div class="stat-label">Toplam Ä°zleyici</div>
</div>
<div class="stat-card">
    <div class="stat-value" id="totalCameras">0</div>
    <div class="stat-label">Toplam Kamera</div>
</div>
</div>
</div>

<div class="card">
    <h2><i class="fas fa-fire"></i> PopÃ¼ler YayÄ±nlar</h2>
    <div class="stream-grid" id="popularStreams">
        <!-- Popular streams will be loaded here -->
    </div>
</div>
</div>

<!-- Streams Page -->
<div class="page" id="streams">
    <div class="card">
        <h2><i class="fas fa-play-circle"></i> CanlÄ± YayÄ±nlar</h2>
        <div class="stream-grid" id="streamsGrid">
            <!-- Streams will be loaded here -->
        </div>
    </div>
</div>

<!-- Cameras Page -->
<div class="page" id="cameras">
    <div class="card">
        <h2>
            <i class="fas fa-camera"></i> Kamera YÃ¶netimi
            <button class="btn btn-primary" id="addCameraBtn" style="margin-left: auto;">
                <i class="fas fa-plus"></i> Kamera Ekle
            </button>
        </h2>

        <!-- Add Camera Form -->
        <div class="card" id="addCameraForm" style="display: none;">
            <h3>Yeni Kamera Ekle</h3>
            <form id="cameraForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cameraName">Kamera AdÄ±</label>
                        <input type="text" id="cameraName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraBrand">Marka</label>
                        <select id="cameraBrand" class="form-control" required>
                            <option value="">SeÃ§iniz</option>
                            <option value="samsung">Samsung</option>
                            <option value="dahua">Dahua</option>
                            <option value="hikvision">Hikvision</option>
                            <option value="axis">Axis</option>
                            <option value="bosch">Bosch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cameraModel">Model</label>
                        <input type="text" id="cameraModel" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraIp">IP Adresi</label>
                        <input type="text" id="cameraIp" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraPort">Port</label>
                        <input type="number" id="cameraPort" class="form-control" value="554" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraUsername">KullanÄ±cÄ± AdÄ±</label>
                        <input type="text" id="cameraUsername" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraPassword">Åžifre</label>
                        <input type="password" id="cameraPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraLocation">Konum</label>
                        <input type="text" id="cameraLocation" class="form-control">
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancelCameraBtn">
                        <i class="fas fa-times"></i> Ä°ptal
                    </button>
                </div>
            </form>
        </div>

        <div id="camerasGrid">
            <!-- Cameras will be loaded here -->
        </div>
    </div>
</div>

<!-- Admin Page -->
<div class="page" id="admin">
    <div class="card admin-only">
        <h2><i class="fas fa-cog"></i> Admin Panel</h2>
        <p>Sistem yÃ¶netimi ve geliÅŸmiÅŸ ayarlar burada yer alacak.</p>

        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-value" id="adminTotalUsers">0</div>
                <div class="stat-label">Toplam KullanÄ±cÄ±</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="adminSystemUptime">0</div>
                <div class="stat-label">Sistem Uptime</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="adminErrorCount">0</div>
                <div class="stat-label">Son 24s Hata</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="adminMemoryUsage">0%</div>
                <div class="stat-label">Bellek KullanÄ±mÄ±</div>
            </div>
        </div>
    </div>
</div>
</main>

<!-- Video Modal -->
<div class="modal" id="videoModal">
    <div class="modal-content">
        <button class="modal-close" id="closeModal">&times;</button>
        <video class="modal-video" id="modalVideo" controls autoplay muted>
            <p>TarayÄ±cÄ±nÄ±z video oynatmayÄ± desteklemiyor.</p>
        </video>
    </div>
</div>

<!-- Login Modal -->
<div class="modal" id="loginModal">
    <div class="modal-content" style="max-width: 400px; background: white; padding: 2rem; border-radius: 15px;">
        <h2 style="text-align: center; margin-bottom: 2rem; color: #333;">GiriÅŸ Yap</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="loginUsername">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="loginUsername" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Åžifre</label>
                <input type="password" id="loginPassword" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
            </button>
        </form>
        <button class="modal-close" id="closeLoginModal" style="top: 10px; right: 15px; color: #333;">&times;</button>
    </div>
</div>
</div>

<script>
    class ArkStreamApp {
        constructor() {
            this.token = localStorage.getItem('token');
            this.user = null;
            this.currentHLS = null;
            this.ws = null;
            this.init();
        }

        async init() {
            this.setupEventListeners();

            if (this.token) {
                await this.verifyToken();
            }

            await this.loadDashboard();
            await this.loadStreams();
            this.connectWebSocket();
        }

        setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const page = e.currentTarget.dataset.page;
                    this.showPage(page);
                });
            });

            // Login/Logout
            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.add('active');
            });

            document.getElementById('logoutBtn').addEventListener('click', () => {
                this.logout();
            });

            document.getElementById('closeLoginModal').addEventListener('click', () => {
                document.getElementById('loginModal').classList.remove('active');
            });

            document.getElementById('loginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                this.login();
            });

            // Video modal
            document.getElementById('closeModal').addEventListener('click', () => {
                this.closeVideoModal();
            });

            // Camera form
            document.getElementById('addCameraBtn').addEventListener('click', () => {
                document.getElementById('addCameraForm').style.display = 'block';
            });

            document.getElementById('cancelCameraBtn').addEventListener('click', () => {
                document.getElementById('addCameraForm').style.display = 'none';
            });

            document.getElementById('cameraForm').addEventListener('submit', (e) => {
                e.preventDefault();
                this.addCamera();
            });
        }

        showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Update nav
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            // Load page data
            switch (pageId) {
                case 'cameras':
                    this.loadCameras();
                    break;
                case 'admin':
                    this.loadAdminData();
                    break;
            }
        }

        async verifyToken() {
            try {
                const response = await fetch('/api/auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${this.token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    this.user = data.user;
                    this.updateUI();
                } else {
                    this.logout();
                }
            } catch (error) {
                console.error('Token verification failed:', error);
                this.logout();
            }
        }

        async login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    this.token = data.token;
                    this.user = data.user;
                    localStorage.setItem('token', this.token);
                    document.getElementById('loginModal').classList.remove('active');
                    this.updateUI();
                    this.connectWebSocket();
                } else {
                    alert(data.error || 'GiriÅŸ baÅŸarÄ±sÄ±z');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('GiriÅŸ sÄ±rasÄ±nda hata oluÅŸtu');
            }
        }

        logout() {
            this.token = null;
            this.user = null;
            localStorage.removeItem('token');
            if (this.ws) {
                this.ws.close();
            }
            this.updateUI();
        }

        updateUI() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');
            const camerasTab = document.getElementById('camerasTab');
            const adminTab = document.getElementById('adminTab');

            if (this.user) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-flex';
                userInfo.style.display = 'flex';
                userName.textContent = this.user.username;
                userRole.textContent = this.user.role;

                // Show tabs based on role
                if (['admin', 'operator'].includes(this.user.role)) {
                    camerasTab.style.display = 'flex';
                }
                if (this.user.role === 'admin') {
                    adminTab.style.display = 'flex';
                }
            } else {
                loginBtn.style.display = 'inline-flex';
                logoutBtn.style.display = 'none';
                userInfo.style.display = 'none';
                camerasTab.style.display = 'none';
                adminTab.style.display = 'none';
            }
        }

        async loadDashboard() {
            try {
                const response = await fetch('/api/dashboard');
                if (response.ok) {
                    const data = await response.json();

                    document.getElementById('totalStreams').textContent = data.summary.streams.total;
                    document.getElementById('activeStreams').textContent = data.summary.streams.active;
                    document.getElementById('totalViewers').textContent = data.summary.viewers.total;
                    document.getElementById('totalCameras').textContent = data.summary.cameras.total;
                }
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }

        async loadStreams() {
            try {
                const response = await fetch('/api/streams/public');
                if (response.ok) {
                    const data = await response.json();
                    this.renderStreams(data.streams);
                }
            } catch (error) {
                console.error('Streams load error:', error);
            }
        }

        renderStreams(streams) {
            const grid = document.getElementById('streamsGrid');
            const popularGrid = document.getElementById('popularStreams');

            if (streams.length === 0) {
                grid.innerHTML = '<p>HenÃ¼z aktif yayÄ±n bulunmuyor.</p>';
                popularGrid.innerHTML = '<p>HenÃ¼z aktif yayÄ±n bulunmuyor.</p>';
                return;
            }

            const streamHTML = streams.map(stream => `
                    <div class="stream-card" data-stream-id="${stream.id}">
                        <div class="stream-preview">
                            <div class="stream-overlay">
                                <button class="play-btn" onclick="app.playStream('${stream.hlsUrl}', '${stream.name}')">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </div>
                        <div class